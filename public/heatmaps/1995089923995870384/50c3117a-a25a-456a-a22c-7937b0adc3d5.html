<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heat map for - Green Planet Remodeling</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC6av-FESCOQG9F-G4oZ0k9KVweacH3KIU"></script>
    <style>
        :root {
            --primary: #f97316;
            --secondary: #f97316;
            --accent: #f59e0b;
            --background: #f8fafc;
            --card: #ffffff;
            --text: #1f2937;
            --border: #e5e7eb;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }

        body {
            font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
                Roboto, sans-serif;
            background-color: var(--background);
            color: var(--text);
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100vh;
            font-size: 11px;
        }

        .average-rank-card {
            /* position: absolute; */
            width: auto;
            height: auto;
            background: white;
            padding: 20px;
            text-align: center;
            overflow: auto;
            z-index: 10;
      }

      .rank-number {
        font-size: 32px;
        font-weight: bold;
        color: #4caf50;
        background: #e8f5e9;
        padding: 10px 20px;
        border-radius: 8px;
        display: inline-block;
        transform: translateY(-10px);
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
      }

      .chart-container {
        display: flex;
        background: white;
        padding: 20px;
        border-radius: 10px;
        /* box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); */
      }

      .title {
        font-size: 16px;
        font-weight: bold;
        color: #333;
        margin-bottom: 10px;
      }

        .dashboard-container {
            display: grid;
            grid-template-columns: 55% 45%;
            grid-template-rows: auto auto 1fr;
            height: calc(100vh - 40px);
        }

        .header {
            grid-column: 1 / 3;
            background-color: white;
            padding: 6px 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 40px;
            border-bottom: 1px solid var(--border);
        }

        .map-container {
            grid-column: 1;
            grid-row: 2;
            padding: 6px;
            display: flex;
            flex-direction: column;
        }

        .data-container {
            grid-column: 2;
            grid-row: 2;
            padding: 6px;
            display: grid;
            grid-template-rows: auto auto 1fr;
            gap: 6px;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
        }

        .card {
            background-color: var(--card);
            border-radius: 0.375rem;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            padding: 8px;
            border: 1px solid var(--border);
            align-self: center;
            height: 100%;
        }

        .card-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--secondary);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .card-title::before {
            content: "";
            display: block;
            width: 3px;
            height: 12px;
            background-color: var(--secondary);
            border-radius: 2px;
        }

        #map {
            height: calc(100vh - 100px);
            width: 100%;
            border-radius: 0.375rem;
            border: 1px solid var(--border);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
        }

        .chart-container {
            height: 200px;
            position: relative;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.125rem 0.375rem;
            border-radius: 9999px;
            font-size: 0.8rem;
            font-weight: 500;
            text-wrap: pretty;
        }

        .badge-orange {
            background-color: #ffedd5;
            color: #c2410c;
            padding-left: 1rem;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8rem;
            height: 93%;
        }

        .data-table th,
        .data-table td {
            padding: 4px 6px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .data-table th {
            background-color: #f8fafc;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            font-size: 0.6rem;
            letter-spacing: 0.05em;
        }

        .data-table tr:hover {
            background-color: #f8fafc;
        }

        .summary-stats {
            display: flex;
            gap: 6px;
            margin-top: 6px;
        }

        .summary-stat {
            flex: 1;
            background-color: white;
            border-radius: 0.375rem;
            padding: 6px;
            text-align: center;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }

        .summary-stat::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--secondary);
        }

        .summary-stat-value {
            font-size: 1rem;
            font-weight: 700;
        }

        .summary-stat-label {
            font-size: 0.6rem;
            color: #64748b;
            margin-top: 0.125rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            width: 100%;
            height: 100%;
        }

        .metric-pill {
            display: inline-flex;
            align-items: center;
            padding: 3px 6px;
            border-radius: 9999px;
            font-size: 0.65rem;
            font-weight: 600;
            gap: 3px;
        }

        .metric-pill-red {
            background-color: #fee2e2;
            color: #b91c1c;
        }

        .metric-pill-yellow {
            background-color: #fef3c7;
            color: #92400e;
        }

        .metric-pill-green {
            background-color: #d1fae5;
            color: #065f46;
        }

        .metric-pill-orange {
            background-color: #ffedd5;
            color: #c2410c;
        }

        .keyword-cell {
            max-width: 120px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .performance-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 4px;
        }

        .performance-good {
            background-color: #10b981;
        }

        .performance-medium {
            background-color: #f59e0b;
        }

        .performance-poor {
            background-color: #ef4444;
        }

        /* Animations */
        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .pulse-animation {
            animation: pulse 2s infinite;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }

        @media (width <= 1500px) {
            
            .grid-2 {
            display: grid;
            grid-template-columns: 1fr;
            gap: 6px;
            width: 100%;
            height: 100%;
        }
        }
    </style>
</head>

<body>

    <div class="header">
        <div>
            <h1 class="text-sm font-bold text-gray-900">Green Planet Remodeling</h1>
            <p class="text-xs text-gray-500">
                34.0675315, -118.4024749
            </p>
        </div>
        <div class="flex items-center gap-2">
            <div class="metric-pill metric-pill-red">
                <span class="inline-block w-2 h-2 rounded-full bg-red-600"></span>
                <span data-field="low_relevance" data-text="Low count: ">Low: 37</span>
            </div>
            <div class="metric-pill metric-pill-yellow">
                <span class="inline-block w-2 h-2 rounded-full bg-yellow-600"></span>
                <span data-field="medium_relevance" data-text="Med count: ">Med: 22</span>
            </div>
            <div class="metric-pill metric-pill-green">
                <span class="inline-block w-2 h-2 rounded-full bg-green-600"></span>
                <span data-field="high_relevance" data-text="High count: ">High: 5</span>
            </div>
            <div class="metric-pill metric-pill-orange">
                <span class="inline-block w-2 h-2 rounded-full bg-orange-600"></span>
                <span data-field="avg_rank_value" data-text="Avg: ">Avg: 5.421875</span>
            </div>
        </div>
    </div>

    <div class="dashboard-container">
        <!-- Map Section (Left Side) -->
        <div class="map-container">
            <div id="map" style="position: relative; overflow: hidden;"></div>
            <div class="summary-stats">
                <div class="summary-stat">
                    <div id="avg-keyword-rank" class="summary-stat-value text-orange-700">5.4</div>
                    <div class="summary-stat-label">Avg Keyword Rank</div>
                </div>
                <div class="summary-stat">
                    <div id="avg-final-rank" class="summary-stat-value text-orange-800">5.4</div>
                    <div class="summary-stat-label">Avg Final Rank</div>
                </div>
                <div class="summary-stat">
                    <div id="avg-percentage" class="summary-stat-value text-orange-700">72.9%</div>
                    <div class="summary-stat-label">Avg Percentage</div>
                </div>
            </div>
        </div>

        <!-- Data Section (Right Side) -->
        <div class="data-container">
            <div class="grid-2">
                <!-- Relevance Distribution -->
                <div class="card">
                    <div class="card-title">Relevance Distribution</div>
                    <div class="average-rank-card">
                        <div>
                            <div class="title">Average Rank</div>
                            <div class="rank-number" id="rankNumber"></div>
                        </div>
                        <div class="chart-container">
                          <canvas id="doughnutChart"></canvas>
                        </div>
                      </div>
                </div>
                
                <div class="card">
                    <div class="card-title">Rank Distribution</div>
                    <div class="chart-container" style="max-height: 90%; min-height: 90%;">
                        <canvas id="rankDistributionChart" width="357" height="100"
                            style="display: block; box-sizing: border-box; height: 100px; width: 357px;"></canvas>
                    </div>
                </div>
            </div>

            <!-- Overall Performance -->
            <!-- <div class="card">
                <div class="card-title">Overall Performance</div>
                <div class="chart-container">
                    <canvas id="overallPerformanceChart" width="738" height="100"
                        style="display: block; box-sizing: border-box; height: 100px; width: 738px;"></canvas>
                </div>
            </div> -->

            <!-- Keyword Performance -->
            <div class="card" style="align-self: self-start; min-height:calc(100vh / 2);">
                <div class="card-title">Keyword Performance Summary</div>
                <div class="overflow-x-auto">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Keyword</th>
                                <th>Avg Rank</th>
                                <th>Avg Final</th>
                                <th>Avg %</th>
                                <th>Locations</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="keywordTableBody">
                            <!-- Table rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>

        const colors = {
            blue: {
                fill: "#4285F4", // Vibrant blue
                stroke: "#000", // Deep navy blue for contrast
                // stroke: "#1E3A8A", // Deep navy blue for contrast
                circleFill: "#1E3A8A", // Softer blue
                circleStroke: "#1E3A8A",
                textFill: "white" // White text for high visibility
            },
            lightGreen: {
                fill: "#66BB6A", // Soft green
                stroke: "#000", // Deep forest green
                // stroke: "#2E7D32", // Deep forest green
                circleFill: "#2E7D32", // Pale green for contrast
                circleStroke: "#2E7D32",
                textFill: "white"
            },
            darkGreen: {
                fill: "#2E7D32", // Deep green
                stroke: "#000", // Almost white green
                // stroke: "#1B5E20", // Almost white green
                circleFill: "#1B5E20", // Medium green for contrast
                circleStroke: "#1B5E20",
                textFill: "white"
            },
            lilaGreen: {
                fill: "#4A8F4A", // Muted deep green
                stroke: "#000", // Darker forest green
                // stroke: "#2E5732", // Darker forest green
                circleFill: "#2E5732", // Soft pastel green
                circleStroke: "#2E5732",
                textFill: "white"
            },
            neonGreen: {
                fill: "#00E676", // Vibrant neon green
                stroke: "#000", // Darker neon contrast
                // stroke: "#00A152", // Darker neon contrast
                circleFill: "#00A152", // Lighter neon for balance
                circleStroke: "#00A152",
                textFill: "white"
            },
            yellow: {
                fill: "#FDD835", // Bright golden yellow
                stroke: "#000", // Deep mustard yellow
                // stroke: "#F9A825", // Deep mustard yellow
                circleFill: "#F9A825", // Soft pastel yellow
                circleStroke: "#F9A825",
                textFill: "white"
            },
            darkYellow: {
                fill: "#FB8C00", // Vivid orange
                stroke: "#000", // Burnt orange
                // stroke: "#000", // Burnt orange
                circleFill: "#FB8C00", // Light warm orange
                circleStroke: "#FF8C00",
                textFill: "white"
            },
            red: {
                fill: "#C62828", // Softer red for reduced harshness
                stroke: "#000", // Muted deep red
                // stroke: "#8E1C1C", // Muted deep red
                circleFill: "#8E1C1C", // Soft coral red
                circleStroke: "#8E1C1C",
                textFill: "white"
            },
            darkRed: {
                fill: "#B71C1C", // Intense dark red
                stroke: "#000", // Almost white-red
                // stroke: "#7F0000", // Almost white-red
                circleFill: "#7F0000", // Muted red tone
                circleStroke: "#7F0000",
                textFill: "white"
            },
            darkYellow_: {
                fill: "#F9A825", // Rich dark golden yellow
                stroke: "#000", // Deep amber
                // stroke: "#BF9000", // Deep amber
                circleFill: "#F9A825", // Warm muted yellow
                circleStroke: "#BF9000",
                textFill: "white"
            },
            darkOrange: {
                fill: "#E65100", // Deep orange
                stroke: "#000", // Black for contrast
                circleFill: "#E65100", // Strong warm orange
                circleStroke: "#FF5722", // Bright reddish-orange
                textFill: "white"
                }

        };

        const mapStarIcon = (number, color = colors.blue) => {
            return ``;
        };

        const mapXIcon = (number, color = colors.red) => {
            const XIcon = `
  
  <svg width="140" height="140" viewBox="0 0 140 140" fill="none" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <filter id="xShadow" x="-10%" y="-10%" width="120%" height="120%">
      <feDropShadow dx="0" dy="3" stdDeviation="2" flood-opacity="0.3" />
    </filter>
  </defs>

  <!-- Smooth, Rounded "X" with Extended Axes -->
  <path d="M15 15 L125 125 M125 15 L15 125"
        stroke="#E74C3C"
        stroke-width="22"
        stroke-linecap="round"
        stroke-linejoin="round"
        filter="url(#xShadow)"/>

  <!-- Well-Balanced Ci7cle -->
  <circle cx="70" cy="75" r="40" fill="#C0392B" stroke="#A93226" stroke-width="9" filter="url(#xShadow)"/>

  <!-- Clearly Visible, Well-Positioned Number -->
  <text x="70" y="78" text-anchor="middle" dominant-baseline="middle" fill="#FFF"
        font-family="Arial, sans-serif" font-weight="bold" font-size="50">
${number}
  </text>
</svg>
  `;

            const XIconPlus = `
      <svg width="140" height="140" viewBox="0 0 140 140" fill="none" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <filter id="xShadow" x="-10%" y="-10%" width="120%" height="120%">
      <feDropShadow dx="0" dy="3" stdDeviation="2" flood-opacity="0.3" />
    </filter>
  </defs>

  <!-- Smooth, Rounded "X" with Extended Axes -->
  <path d="M15 15 L125 125 M125 15 L15 125"
        stroke="#E74C3C"
        stroke-width="22"
        stroke-linecap="round"
        stroke-linejoin="round"
        filter="url(#xShadow)"/>

  <!-- Well-Balanced Circle -->
  <circle cx="70" cy="72" r="49" fill="#C0392B" stroke="#A93226" stroke-width="10" filter="url(#xShadow)"/>

  <!-- Clearly Visible, Well-Positioned Number -->
  <text x="75" y="78" text-anchor="middle" dominant-baseline="middle" fill="#FFF"
        font-family="Arial, sans-serif" font-weight="bold" font-size="50">
${number}+
  </text>
</svg>
  `;

            return number >= 20 ? XIconPlus : XIcon;
        };

        const mapFlagIcon = (number, color = colors.red) => {
            return `
  <svg width="160" height="120" viewBox="0 0 160 120" fill="none" xmlns="http://www.w3.org/2000/svg">
    <defs>
        <filter id="flagShadow" x="-10%" y="-10%" width="120%" height="120%">
            <feDropShadow dx="0" dy="3" stdDeviation="2" flood-opacity="0.3" />
        </filter>
    </defs>

    <rect x="20" y="10" width="14" height="160" fill="#7F0000" rx="7" ry="7"/>
    <path d="M34 10
            Q150 5 130 45
            Q110 80 34 70
            Z"
          fill="#B71C1C"
          stroke="#7F0000"
          stroke-width="5"
          filter="url(#flagShadow)"/>

    <rect x="45" y="15.5" width="60" height="50" rx="8" ry="8" fill="#C62828" stroke="#7F0000" stroke-width="3" opacity="0.9"/>

    <text x="75" y="45" text-anchor="middle" dominant-baseline="middle" fill="#FFF" font-family="Arial, sans-serif" font-weight="bold" font-size="50">${number}</text>
</svg>

  `;
        };

        const mapMarkIcon = (number, color = colors.lilaGreen) => {
            const twoDigit = `

      <svg width="73" height="109.5" viewBox="0 0 73 109.5" fill="none" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <filter id="markerShadow" x="-20%" y="-10%" width="140%" height="140%">
            <feDropShadow dx="0" dy="2" stdDeviation="1.5" flood-opacity="0.25" />
          </filter>
          <filter id="circleShadow" x="-20%" y="-20%" width="140%" height="140%">
            <feDropShadow dx="0" dy="1" stdDeviation="1" flood-opacity="0.3" />
          </filter>
        </defs>

        <!-- Map Marker Shape -->
        <path d="M36.5 109.5
                C25 90, 7 67, 7 43
                C7 20 22 7 36.5 7
                C51 7 66 20 66 43
                C66 67 48 90 36.5 109.5
                Z"
              fill="${color.fill}"
              filter="url(#markerShadow)" />
              
        <!-- Elegant outline -->
        <path d="M36.5 107.5
                C26 89, 9 66, 9 43
                C9 22 24 9 36.5 9
                C49 9 64 22 64 43
                C64 66 47 89, 36.5 107.5
                Z"
              stroke="${color.stroke}" stroke-width="3" fill="none"/>

        <!-- Adjusted Circle for Multi-Digit Numbers -->
        <circle cx="36.5" cy="38" r="24" fill="${color.circleFill}" filter="url(#circleShadow)" stroke="${color.circleStroke}" stroke-width="2.5" />

        <!-- Number inside (supports 10-99) -->
        <text x="50%" y="40" text-anchor="middle" dominant-baseline="middle" fill="${color.textFill}" font-family="Arial, sans-serif" font-weight="bold" font-size="35">${number}</text>
      </svg>
  `;

            const oneDigit = `
  <svg width="73" height="109.5" viewBox="0 0 73 109.5" fill="none" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <filter id="markerShadow" x="-20%" y="-10%" width="140%" height="140%">
        <feDropShadow dx="0" dy="2" stdDeviation="1.5" flood-opacity="0.25" />
      </filter>
      <filter id="circleShadow" x="-20%" y="-20%" width="140%" height="140%">
        <feDropShadow dx="0" dy="1" stdDeviation="1" flood-opacity="0.3" />
      </filter>
    </defs>

    <!-- Map Marker Shape -->
    <path d="M36.5 109.5
            C25 90, 7 67, 7 43
            C7 20 22 7 36.5 7
            C51 7 66 20 66 43
            C66 67 48 90 36.5 109.5
            Z"
          fill="${color.fill}"
          filter="url(#markerShadow)" />

    <!-- Elegant outline -->
    <path d="M36.5 107.5
            C26 89, 9 66, 9 43
            C9 22 24 9 36.5 9
            C49 9 64 22 64 43
            C64 66 47 89, 36.5 107.5
            Z"
          stroke="${color.stroke}" stroke-width="3" fill="none"/>

    <!-- Circle for number -->
    <circle cx="36.5" cy="38" r="22" fill="${color.circleFill}" filter="url(#circleShadow)" stroke="${color.circleStroke}" stroke-width="2.5" />

    <!-- Number inside -->
    <text x="50%" y="42" text-anchor="middle" dominant-baseline="middle" fill="${color.textFill}" font-family="Arial, sans-serif" font-weight="bold" font-size="40">${number}</text>
  </svg>
`;

            return number > 9 ? twoDigit : oneDigit;
        };

        const SGVIcons = (rankType) => {
            switch (rankType) {
                case 1: {
                    return mapMarkIcon(rankType, colors.neonGreen);
                }
                case 2: {
                    return mapMarkIcon(rankType, colors.neonGreen);
                }
                case 3: {
                    return mapMarkIcon(rankType, colors.lightGreen);
                }
                case 4: {
                    return mapMarkIcon(rankType, colors.lilaGreen);
                }
                case 5:
                case 6:
                case 7:
                case 8: {
                    return mapMarkIcon(rankType, colors.yellow);
                }
                case 9:
                case 10: {
                    return mapMarkIcon(rankType, colors.darkYellow);
                }
                case 11:
                case 12: {
                    return mapMarkIcon(rankType, colors.darkOrange);
                }
                case 13:
                case 14:
                case 15: {
                    return mapMarkIcon(rankType, colors.red);
                }

                case 16:
                case 17:
                case 18:
                case 19: {
                    return mapFlagIcon(rankType, colors.darkRed);
                }

                default:
                    return mapXIcon(rankType, colors.darkRed);
            }
        };

        const seoData = {'high_relevance': 0.0, 'medium_relevance': 1.0, 'low_relevance': 129.0, 'avg_rank_value': 19.915384615384614, 'average_rank_percentage': 0.4230769230769231, 'main_coordinates': [34.0675315, -118.4024749]}

        for (const k in seoData) {

            const element = document?.querySelector(`[data-field='${k}']`)
            if (element) {
                element.innerHTML = element.dataset.text + seoData[k].toFixed(2)
            }
        }

        let locationData = [{'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.0675315, 'lng': -118.4024749, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.0675315, 'lng': -118.38076206580637, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.08310820713796, 'lng': -118.39161848290318, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.08310820713796, 'lng': -118.41333131709682, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 9.0, 'percentage': 55.0}, 'percentage': 55.0}], 'lat': 34.0675315, 'lng': -118.42418773419364, 'average_percentage': 55.0, 'final_rank': 9}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.05195479286204, 'lng': -118.41333131709682, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.05195479286204, 'lng': -118.39161848290318, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.0675315, 'lng': -118.35904923161273, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.08551793211838, 'lng': -118.3648671680003, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.098684914275914, 'lng': -118.38076206580637, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.10350436423675, 'lng': -118.4024749, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.098684914275914, 'lng': -118.42418773419364, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.08551793211838, 'lng': -118.4400826319997, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.0675315, 'lng': -118.44590056838727, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.049545067881624, 'lng': -118.4400826319997, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.03637808572409, 'lng': -118.42418773419364, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.031558635763254, 'lng': -118.4024749, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.03637808572409, 'lng': -118.38076206580637, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.049545067881624, 'lng': -118.3648671680003, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.0675315, 'lng': -118.3373363974191, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.085986666273136, 'lng': -118.34126472979568, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.10221586712448, 'lng': -118.35257591206481, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.114261621413874, 'lng': -118.36990564870955, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.12067103339761, 'lng': -118.39116371773088, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.12067103339761, 'lng': -118.41378608226913, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.114261621413874, 'lng': -118.43504415129046, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.10221586712448, 'lng': -118.4523738879352, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.085986666273136, 'lng': -118.46368507020432, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.0675315, 'lng': -118.46761340258091, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.049076333726866, 'lng': -118.46368507020432, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.032847132875524, 'lng': -118.4523738879352, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.02080137858613, 'lng': -118.43504415129046, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.01439196660239, 'lng': -118.41378608226913, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.01439196660239, 'lng': -118.39116371773088, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.02080137858613, 'lng': -118.36990564870955, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.032847132875524, 'lng': -118.35257591206481, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.049076333726866, 'lng': -118.34126472979568, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.0675315, 'lng': -118.31562356322546, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.08542367509607, 'lng': -118.31835215767867, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.102191619028034, 'lng': -118.32636649341373, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.11678174021046, 'lng': -118.33916300024175, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.12827728767076, 'lng': -118.35593762657646, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.13595595388433, 'lng': -118.37563636095248, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.13933526001279, 'lng': -118.39702145944212, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.13820287182391, 'lng': -118.41874921765834, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.1326299414322, 'lng': -118.43945440064334, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.12296663654998, 'lng': -118.45783602560184, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.10982013816216, 'lng': -118.47273910743479, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.09401648911188, 'lng': -118.48322723070093, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.07654869079072, 'lng': -118.48864138804284, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.05851430920928, 'lng': -118.48864138804284, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.04104651088812, 'lng': -118.48322723070093, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.02524286183784, 'lng': -118.47273910743479, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.01209636345002, 'lng': -118.45783602560184, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.0024330585678, 'lng': -118.43945440064334, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 33.996860128176095, 'lng': -118.41874921765834, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 33.99572773998721, 'lng': -118.39702145944212, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 33.999107046115675, 'lng': -118.37563636095248, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.00678571232924, 'lng': -118.35593762657646, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.01828125978954, 'lng': -118.33916300024175, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.03287138097197, 'lng': -118.32636649341373, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.049639324903936, 'lng': -118.31835215767867, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.0675315, 'lng': -118.29391072903182, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.08563471083552, 'lng': -118.29613304398941, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.1029967740924, 'lng': -118.30270900702672, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.11890688486094, 'lng': -118.31336939744435, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.132713681336924, 'lng': -118.32767777760606, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.14385191165039, 'lng': -118.34504836074686, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.15186557534362, 'lng': -118.36476999315201, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.156426592083456, 'lng': -118.38603526887367, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.15734823330866, 'lng': -118.4079735850252, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.154592766919194, 'lng': -118.42968678436574, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.14827300203279, 'lng': -118.45028592596309, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.13864767056644, 'lng': -118.46892767853996, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.1261108347213, 'lng': -118.48484884655551, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.1111757540299, 'lng': -118.49739761552057, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.09445387245053, 'lng': -118.50606023735926, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.07662978577979, 'lng': -118.5104820633157, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.058433214220216, 'lng': -118.5104820633157, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.04060912754947, 'lng': -118.50606023735926, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.0238872459701, 'lng': -118.49739761552057, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.0089521652787, 'lng': -118.48484884655551, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 33.99641532943356, 'lng': -118.46892767853996, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 33.986789997967215, 'lng': -118.45028592596309, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 33.98047023308081, 'lng': -118.42968678436574, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 33.97771476669134, 'lng': -118.4079735850252, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 33.97863640791655, 'lng': -118.38603526887367, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 33.98319742465638, 'lng': -118.36476999315201, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 33.991211088349615, 'lng': -118.34504836074686, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.00234931866308, 'lng': -118.32767777760606, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.01615611513906, 'lng': -118.31336939744435, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.032066225907606, 'lng': -118.30270900702672, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.04942828916448, 'lng': -118.29613304398941, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.0675315, 'lng': -118.27219789483819, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.085769830696016, 'lng': -118.27407181096007, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.10348347782435, 'lng': -118.27963965017071, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.12016285200827, 'lng': -118.28874123587337, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.13532811802058, 'lng': -118.30111473201859, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.148542998769436, 'lng': -118.31640417565063, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.15942732619595, 'lng': -118.33416971731364, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.16766797801712, 'lng': -118.3539002747196, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.173027885683766, 'lng': -118.37502823565528, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.175352854411074, 'lng': -118.39694578715215, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.174575999081824, 'lng': -118.41902240115881, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.17071966840941, 'lng': -118.4406229736851, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.16389480200609, 'lng': -118.46112609558747, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.15429773885228, 'lng': -118.47994192937878, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.142204568981576, 'lng': -118.49652917777871, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.127963190873196, 'lng': -118.51041065585115, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.11198330304609, 'lng': -118.52118701874589, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.09472461777854, 'lng': -118.52854825012291, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.07668363602289, 'lng': -118.53228258075808, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.05837936397711, 'lng': -118.53228258075808, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.040338382221464, 'lng': -118.52854825012291, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.023079696953914, 'lng': -118.52118701874589, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.00709980912681, 'lng': -118.51041065585115, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 33.992858431018426, 'lng': -118.49652917777871, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 33.980765261147724, 'lng': -118.47994192937878, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 33.97116819799391, 'lng': -118.46112609558747, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 33.96434333159059, 'lng': -118.4406229736851, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 33.96048700091818, 'lng': -118.41902240115881, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 33.95971014558893, 'lng': -118.39694578715215, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 33.96203511431624, 'lng': -118.37502823565528, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 33.96739502198288, 'lng': -118.3539002747196, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 33.97563567380405, 'lng': -118.33416971731364, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 33.986520001230566, 'lng': -118.31640417565063, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 33.99973488197942, 'lng': -118.30111473201859, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.01490014799173, 'lng': -118.28874123587337, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.031579522175655, 'lng': -118.27963965017071, 'average_percentage': 0.0, 'final_rank': 20}, {'data': [{'keyword': 'Bathroom Remodeling, Kitchen Remodeling, Home Additions, ADU Garage Conversions, Roofing, Custom Homes', 'location_rank': {'rank': 21.0, 'percentage': 0.0}, 'percentage': 0.0}], 'lat': 34.049293169303986, 'lng': -118.27407181096007, 'average_percentage': 0.0, 'final_rank': 20}]

        function calculateKeywordAverages() {
            const keywords = {};

            locationData.forEach((location) => {
                location.data.forEach((item) => {
                    if (!keywords[item.keyword]) {
                        keywords[item.keyword] = {
                            totalRank: 0,
                            totalFinalRank: 0,
                            totalPercentage: 0,
                            locations: [],
                            count: 0
                        };
                    }

                    keywords[item.keyword].totalRank += item.location_rank.rank;
                    keywords[item.keyword].totalFinalRank += location.final_rank;
                    keywords[item.keyword].totalPercentage += item.percentage;
                    keywords[item.keyword].locations.push({
                        lat: location.lat,
                        lng: location.lng,
                        rank: item.location_rank.rank,
                        finalRank: location.final_rank,
                        percentage: item.percentage
                    });
                    keywords[item.keyword].count++;
                });
            });

            const keywordAverages = {};
            for (const [keyword, data] of Object.entries(keywords)) {
                keywordAverages[keyword] = {
                    avgRank: data.totalRank / data.count,
                    avgFinalRank: data.totalFinalRank / data.count,
                    avgPercentage: data.totalPercentage / data.count,
                    locations: data.locations,
                    count: data.count
                };
            }

            return keywordAverages;
        }

        function initMap() {
            const mainCoordinates = {
                lat: locationData[locationData.length - 1].lat,
                lng: locationData[locationData.length - 1].lng
            };

            const map = new google.maps.Map(document.getElementById("map"), {
                zoom: 17,
                center: mainCoordinates,
                styles: [
                    {
                        featureType: "administrative",
                        elementType: "geometry",
                        stylers: [{ visibility: "off" }]
                    },
                    {
                        featureType: "poi",
                        stylers: [{ visibility: "off" }]
                    },
                    {
                        featureType: "road",
                        elementType: "labels.icon",
                        stylers: [{ visibility: "off" }]
                    },
                    {
                        featureType: "transit",
                        stylers: [{ visibility: "off" }]
                    }
                ]
            });

            // Create markers for each location
            locationData.forEach((location, index) => {
                // Determine marker color based on rank (better rank = greener)
                let markerColor = "#ef4444"; // Default red for poor rank

                if (location.final_rank <= 10) {
                    markerColor = "#10b981"; // Green for good rank
                } else if (location.final_rank <= 15) {
                    markerColor = "#f59e0b"; // Yellow for medium rank
                }

                const iconType = 'custom'

                let marker = {}
                if (iconType == "custom") {
                    marker = new google.maps.Marker({
                        position: { lat: location.lat, lng: location.lng },
                        map: map,
                        animation: google.maps.Animation.BOUNCE,
                        title: `Location ${index + 1}`,
                        icon: {
                            url:
                                "data:image/svg+xml;charset=UTF-8," +
                                encodeURIComponent(SGVIcons(location.final_rank)),
                            scaledSize: new google.maps.Size(50, 50),
                            anchor: new google.maps.Point(25, 50)
                        }
                    });
                }
                else {
                    marker = new google.maps.Marker({
                        position: { lat: location.lat, lng: location.lng },
                        map: map,
                        animation: google.maps.Animation.BOUNCE,
                        title: `Location ${index + 1}`,
                        icon: {
                            path: google.maps.SymbolPath.CIRCLE,
                            fillColor: '#f97316', // Orange
                            fillOpacity: 0.8,
                            strokeColor: '#ffffff',
                            strokeWeight: 2,
                            scale: 10
                        },
                        label: {
                            text: `${location.final_rank}`,
                            color: 'white',
                            fontSize: '10px'
                        },
                    });
                }

                // Create info window content with all keywords for this location
                let keywordsContent = "";
                location.data.forEach((item) => {
                    keywordsContent += `
                          <p style="margin: 0 0 3px;">
                              <strong>${item.keyword}:</strong>
                              Rank ${item.location_rank.rank},
                              Keyword relevance: ${item.location_rank.percentage}%
                          </p>
                      `;
                });
                // Add info window for each marker
                const infoContent = `
                      <div style="padding: 6px; max-width: 180px; font-size: 11px;">
                          <h3 style="margin: 0 0 4px; font-weight: bold;">Location number ${index + 1
                    }</h3>
                          <div style="margin-bottom: 3px;">
                              ${keywordsContent}
                          </div>
                          <p style="margin: 0 0 3px;"><strong>Avg Percentage:</strong> ${location.average_percentage
                    }%</p>
                          <p style="margin: 0 0 3px;"><strong>Final Rank:</strong> ${location.final_rank
                    }</p>
                          <p style="margin: 0;"><strong>Coordinates:</strong> ${location.lat.toFixed(
                        6
                    )}, ${location.lng.toFixed(6)}</p>
                      </div>
                  `;

                const infoWindow = new google.maps.InfoWindow({
                    content: infoContent
                });

                marker.addListener("click", () => {
                    infoWindow.open(map, marker);
                });
            });

            // Create grid overlay
            const bounds = new google.maps.LatLngBounds();
            locationData.forEach((location) => {
                bounds.extend(new google.maps.LatLng(location.lat, location.lng));
            });

            // Expand bounds slightly to ensure all markers are visible
            bounds.extend(
                new google.maps.LatLng(
                    bounds.getNorthEast().lat() + 0.003,
                    bounds.getNorthEast().lng() + 0.003
                )
            );
            bounds.extend(
                new google.maps.LatLng(
                    bounds.getSouthWest().lat() - 0.003,
                    bounds.getSouthWest().lng() - 0.003
                )
            );
            map.fitBounds(bounds);

            // Draw grid lines connecting the points
            const gridLines = [];

            // Find unique latitudes and longitudes
            const uniqueLats = [...new Set(locationData.map((loc) => loc.lat))];
            const uniqueLngs = [...new Set(locationData.map((loc) => loc.lng))];

            // Draw horizontal grid lines

            // Draw circular grid lines to create a grid pattern
            const center = {
                lat: (bounds.getNorthEast().lat() + bounds.getSouthWest().lat()) / 2,
                lng: (bounds.getNorthEast().lng() + bounds.getSouthWest().lng()) / 2
            };

            const radiusStep = 0.008; // Approximately 500 meters
            const numCircles = 10;

            for (let i = 1; i <= numCircles; i++) {
                const radius = i * radiusStep;
                const circle = new google.maps.Circle({
                    strokeColor: "#f97316",
                    strokeOpacity: 0.3,
                    strokeWeight: 1,
                    fillOpacity: 0,
                    map: map,
                    center: center,
                    radius: radius * 111000 // Convert degrees to meters (approx)
                });
            }

            // Add a legend to the map
            const legend = document.createElement("div");
            legend.style.backgroundColor = "white";
            legend.style.padding = "6px";
            legend.style.margin = "8px";
            legend.style.border = "1px solid #e5e7eb";
            legend.style.borderRadius = "4px";
            legend.style.fontSize = "9px";
            legend.style.boxShadow = "0 1px 2px rgba(0,0,0,0.1)";
            legend.innerHTML =
                '<div style="font-weight:600;margin-bottom:4px;color:#1f2937;">Legend</div>' +
                '<div style="display:flex;align-items:center;margin-bottom:3px;"><div style="width:8px;height:8px;background:#10b981;border-radius:50%;margin-right:4px;"></div>Good Rank (≤10)</div>' +
                '<div style="display:flex;align-items:center;margin-bottom:3px;"><div style="width:8px;height:8px;background:#f59e0b;border-radius:50%;margin-right:4px;"></div>Medium (11-15)</div>' +
                '<div style="display:flex;align-items:center;margin-bottom:3px;"><div style="width:8px;height:8px;background:#ef4444;border-radius:50%;margin-right:4px;"></div>Poor Rank (>15)</div>' +
                '<div style="display:flex;align-items:center;margin-bottom:3px;"><div style="width:16px;height:2px;background:#f97316;margin-right:4px;"></div>Grid Line</div>' +
                '<div style="display:flex;align-items:center;"><div style="width:12px;height:12px;border:1px solid #f97316;border-radius:50%;margin-right:4px;"></div>Radius</div>';

            map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(legend);
        }

        // Initialize Charts
        function initCharts() {
            Chart.register(ChartDataLabels);

            // Calculate keyword averages
            const keywordAverages = calculateKeywordAverages();

            // Collect all relevance data
            const relevanceData = {
                high: 0,
                medium: 0,
                low: 0
            };

            // Count keywords by relevance category based on their average rank
            Object.values(keywordAverages).forEach((data) => {
                if (data.avgRank <= 7) {
                    relevanceData.low++; // Low relevance (good)
                } else if (data.avgRank <= 15) {
                    relevanceData.medium++; // Medium relevance
                } else {
                    relevanceData.high++; // High relevance (poor)
                }
            });

            const rankDistCtx = document
                .getElementById("rankDistributionChart")
                .getContext("2d");

            // Count occurrences of each final rank
            const rankCounts = {};
            locationData.forEach((location) => {
                const rank = location.final_rank;
                rankCounts[rank] = (rankCounts[rank] || 0) + 1;
            });

            const rankLabels = Object.keys(rankCounts).sort((a, b) => a - b);
            const rankValues = rankLabels.map((rank) => rankCounts[rank]);

            // Determine colors based on rank value
            const rankColors = rankLabels.map((rank) => {
                if (rank <= 10) return "#10b981"; // Green for good ranks
                if (rank <= 15) return "#f59e0b"; // Yellow for medium ranks
                return "#ef4444"; // Red for poor ranks
            });

            const rankDistChart = new Chart(rankDistCtx, {
                type: "pie",
                data: {
                    labels: rankLabels.map((rank) => `Rank ${rank}`),
                    datasets: [
                        {
                            data: rankValues,
                            backgroundColor: rankColors,
                            borderColor: "#ffffff",
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        datalabels: {
                            color: "#ffffff",
                            font: {
                                weight: "bold",
                                size: 16
                            },
                            formatter: (value, context) => {
                                return value > 0 ? value : "";
                            }
                        },
                        legend: {
                            position: "right",
                            labels: {
                                boxWidth: 8,
                                padding: 6,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            bodyFont: {
                                size: 12
                            },
                            callbacks: {
                                label: function (context) {
                                    const label = context.label || "";
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce(
                                        (a, b) => a + b,
                                        0
                                    );
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });

            // Calculate overall averages across all keywords
            let totalRank = 0;
            let totalFinalRank = 0;
            let totalPercentage = 0;
            let totalCount = 0;

            // Collect all keyword data points
            locationData.forEach((location) => {
                location.data.forEach((item) => {
                    totalRank += item.location_rank.rank;
                    totalFinalRank += location.final_rank;
                    totalPercentage += item.percentage;
                    totalCount++;
                });
            });

            // Calculate averages
            const overallAvgRank = totalRank / totalCount;
            const overallAvgFinalRank = totalFinalRank / totalCount;
            const overallAvgPercentage = totalPercentage / totalCount;

            // Update summary stats
            document.getElementById("avg-keyword-rank").textContent =
                overallAvgRank.toFixed(1);
            document.getElementById("avg-final-rank").textContent =
                overallAvgFinalRank.toFixed(1);
            document.getElementById("avg-percentage").textContent =
                overallAvgPercentage.toFixed(1) + "%";

            //populateKeywordsPerformantChart(overallAvgRank, overallAvgFinalRank, overallAvgPercentage)
        }

        function populateKeywordsPerformantChart (
            overallAvgRank,
            overallAvgFinalRank,
            overallAvgPercentage
        ) {
            const overallCtx = document
                .getElementById("overallPerformanceChart")
                .getContext("2d");

            const overallChart = new Chart(overallCtx, {
                type: "bar",
                data: {
                    labels: ["Keyword Rank", "Final Rank", "Percentage (%)"],
                    datasets: [
                        {
                            label: "Overall Performance",
                            data: [
                                overallAvgRank,
                                overallAvgFinalRank,
                                overallAvgPercentage
                            ],
                            backgroundColor: [
                                "#f97316", // orange
                                "#fb923c", // lighter orange
                                "#fdba74" // even lighter orange
                            ],
                            borderColor: "#ffffff",
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                font: {
                                    size: 16 // Increased font size for better readability
                                }
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    size: 14 // Increased font size for x-axis labels
                                }
                            }
                        }
                    },
                    plugins: {
                        datalabels: {
                            color: "#ffffff",
                            backgroundColor: "rgba(0, 0, 0, 0.6)",
                            borderRadius: 3,
                            font: {
                                weight: "bold",
                                size: 14 // Increased size for the labels inside the bars
                            },
                            padding: 5,
                            formatter: (value) => {
                                return value.toFixed(1);
                            }
                        },
                        legend: {
                            display: false,
                        },
                        tooltip: {
                            bodyFont: {
                                size: 14 // Increased tooltip font size for better readability
                            }
                        }
                    }
                }
            });
        }
        // Populate Keyword Performance Table
        function populateKeywordTable() {
            const tableBody = document.getElementById("keywordTableBody");
            const keywordAverages = calculateKeywordAverages();

            // Add a row for each keyword with its average metrics
            for (const [keyword, data] of Object.entries(keywordAverages)) {
                const row = document.createElement("tr");

                // Determine performance status
                let performanceStatus = "poor";
                let performanceClass = "performance-poor";

                if (data.avgRank <= 7) {
                    performanceStatus = "good";
                    performanceClass = "performance-good";
                } else if (data.avgRank <= 15) {
                    performanceStatus = "medium";
                    performanceClass = "performance-medium";
                }

                row.innerHTML = `
                      <td class="keyword-cell" title="${keyword}">
                          <span class="badge badge-orange">${keyword}</span>
                      </td>
                      <td>${data.avgRank.toFixed(1)}</td>
                      <td>${data.avgFinalRank.toFixed(1)}</td>
                      <td>${data.avgPercentage.toFixed(1)}%</td>
                      <td>${data.count}</td>
                      <td><span class="performance-indicator ${performanceClass}"></span>${performanceStatus}</td>
                  `;

                tableBody.appendChild(row);
            }

            // Add an overall average row
            const overallRow = document.createElement("tr");
            overallRow.style.backgroundColor = "#fff7ed"; // Light orange background
            overallRow.style.fontWeight = "bold";

            // Calculate overall averages
            let totalRank = 0;
            let totalFinalRank = 0;
            let totalPercentage = 0;
            let totalCount = 0;

            Object.values(keywordAverages).forEach((data) => {
                totalRank += data.avgRank * data.count;
                totalFinalRank += data.avgFinalRank * data.count;
                totalPercentage += data.avgPercentage * data.count;
                totalCount += data.count;
            });

            const avgRank = totalRank / totalCount;
            const avgFinalRank = totalFinalRank / totalCount;
            const avgPercentage = totalPercentage / totalCount;

            // Determine overall performance status
            let overallPerformanceStatus = "poor";
            let overallPerformanceClass = "performance-poor";

            if (avgRank <= 7) {
                overallPerformanceStatus = "good";
                overallPerformanceClass = "performance-good";
            } else if (avgRank <= 15) {
                overallPerformanceStatus = "medium";
                overallPerformanceClass = "performance-medium";
            }

            overallRow.innerHTML = `
                  <td>
                      <span class="badge badge-orange">Overall Average</span>
                  </td>
                  <td>${avgRank.toFixed(1)}</td>
                  <td>${avgFinalRank.toFixed(1)}</td>
                  <td>${avgPercentage.toFixed(1)}%</td>
                  <td>${totalCount}</td>
                  <td><span class="performance-indicator ${overallPerformanceClass}"></span>${overallPerformanceStatus}</td>
              `;

            tableBody.appendChild(overallRow);
        }

        // Initialize everything when the page loads
        window.onload = function () {
            initMap();
            initCharts();
            populateKeywordTable();

            document.getElementById("rankNumber").innerHTML = `${seoData.avg_rank_value.toFixed(2)}`;

            let finalPercentage = "metric-pill-green"

            if (seoData.avg_rank_value >= 8 && seoData.avg_rank_value <= 14) {
                finalPercentage = "metric-pill-yellow"
            }
            else if (seoData.avg_rank_value >= 15) {
                finalPercentage = "metric-pill-red"
            }
            document.getElementById("rankNumber").classList.add(finalPercentage)

            const ctx = document.getElementById("doughnutChart").getContext("2d");
            new Chart(ctx, {
            type: "doughnut",
            data: {
                labels: ["Low", "Medium", "High"],
                datasets: [
                {
                    label: "Average Percentage",
                    data: [
                        seoData.low_relevance,
                        seoData.medium_relevance,
                        seoData.high_relevance
                    ],
                    backgroundColor: [
                    "#FF5733",
                    "#FFC300",
                    "#4CAF50",
                    "#2196F3",
                    "#9C27B0"
                    ],
                    borderColor: ["#D84315", "#FF8F00", "#2E7D32", "#1565C0", "#6A1B9A"],
                    borderWidth: 2
                }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: "0%",
                plugins: {
                    datalabels: {
                            color: "#ffffff",
                            font: {
                                weight: "bold",
                                size: 20
                            },
                            formatter: (value) => {
                                return value > 0 ? value : "";
                            }
                        },
                    legend: {
                        position: "right",
                        labels: {
                                boxWidth: 30,
                                padding: 6,
                                font: {
                                    size: 17
                                }
                            }
                    },
                    tooltip: {
                        bodyFont: {
                            size: 16,
                        },
                        callbacks: {
                                label: function (context) {
                                    const label = context.label || "";
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce(
                                        (a, b) => a + b,
                                        0
                                    );
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                    }
                }
            }
            });

        };
    </script>

</body>

</html>